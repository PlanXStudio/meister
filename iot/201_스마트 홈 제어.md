# 스마트 홈 제어

## Auto 제어기와 스마트 홈
Auto 제어기와 주변장치를 조합하면, 가정이나 사무실을 프로그래밍할 수 있음

### 디지털 I/O
전원(DC12V, GND)과 프로그래밍 가능한 디지털 입출력(DIN, DOUT) 포트를 DIO 클래스로 접근
- IN, OUT: 모드 상수
- LOW, HIGH: 상태 상수 
- P_RELAY: 딕셔너리로 릴레이 채널(0 ~ 2)에 대한 핀 번호 제공
- P18(): 풀 다운 상태의 입력 전용 포트로 가스검출기의 입력 라인(5V ~ 6V) 연결 (Active High)
- P17(): 풀 업 상태의 입력 전용 포트로 PIR, LimitSiwtch 등 연결 (Active Low)
- P8(): 3V3 전압으로 운영되는 범용 입출력 포트
- P23(): 3V3 전압으로 운영되는 범용 입출력 포트
- Device.RELAY, Device.PWM: 팬, 조명은 릴레이 또는 PWM 포트에 연결할 수 있으며, 이 상수로 연결 구분 

### 릴레이
입력(Pole) 하나, 출력 하나인 SPST(Single Pole Single Throw) 타입
- C(공용), O(A접점)로 구성된 3개 채널 포트 제공
  - 입력은 내부 전원(5V, 12V) 또는 외부 라인 중 선택
  - 출력은 A 접점
- DIO.P_RELAY 딕서너리로 채널을 구분하며, Relay 객체로 접근
  - Relay(pin, value=0)

```python
r0 = Relay(DIO.P_RELAY[0])
r0.on()
r1.off()
```

**그룹화**
RelayTerminal 객체로 여러 개의 릴레이를 그룹화할 수 있음
```python
r0 = Relay(DIO.P_RELAY[0])
r1 = Relay(DIO.P_RELAY[1])
r2 = Relay(DIO.P_RELAY[2])
rt = RelayTerminal(r0,, r1, r2)
rt.on(0)
rt.on(2)
rt.off(2)
rt.off(0)
```

### PWM
출력신호 제어용 컨트롤러로 주파수와 튜티비(주기별 HIGH 유지 시간)로 HIGH, LOW 상태를 제어해 평균적으로 아날로그 출력 효과를 가짐
모터나 조명과 같이 출력 전압 변화(전류량 변화)로 속도나 밝기가 변하는 장치에 적용

### FAN
- FAN은 12V DC 모터 내장
- 검정선은 GND, 빨강선은 릴레이 채널2 또는 3의 O 포트에 연결
  - 입력은 내부 전원 12V 선택(기본값)
  - XNode의 D6(CH2) 또는 D5(CH3) 포트로 릴레이 ON/OFF
  - FAN 객체(기본값은 채널3)의 on(), off() 메소드로 제어
    ```python
    fan = FAN() #기본값은 채널3(D5)
    fan.on()
    fan.off()
    ```

### 조명
- 조명은 12V LED 등
- 검정선은 GND, 빨강선은 릴레이 채널2 또는 3의 O 포트에 연결
  - 입력은 내부 전원 12V 선택(기본값)
  - XNode의 D6(CH2) 또는 D5(CH3) 포트로 릴레이 ON/OFF
  - Light 객체의 on(), off() 메소드로 제어
  ```python
  light = Light() #기본값은 채널2 (D6)
  light.on()
  light.off()
  ```

### 도어락
- 도어락은 자체 전원으로 동작하며, 내부에서는 이벤트 버튼으로 열고 닫음
- 이벤트 선 중 하나는 릴레이 채널1의 C 나머지 하나는 O 포트에 연결
  - 입력은 외부 전원 선택(기본값)
  - XNode D0 포트로 채널 ON/OFF
  - DoorLock 객체의 work() 메소드로 제어
  ```python
  dl = DoorLock() #기본값은 채널1(D0)
  dl.work()
  ```

### PWM 컨트롤러
- ON, OFF 또는 PWM 값으로 LED의 밝기나 모터의 회전 방향 및 속도 제어
- Auto 제어기에 I2C 타입의 12비트 PWM 컨트롤러 내장
- 모터 제어를 위해 A(CH0), /A(CH1)와 B(CH2), /B(CH3)로 구성된 포트 제공
  - 입력은 내부 전원 5V, 12V 중 선택 (기본값은 12V)
  - 출력은 PWM 듀티비 0%(OFF) ~ 100%(ON)

### 가스 잠금 장치 제어
- 가스 잠금장치는 모터 드라이버로 제어
- 검정선은 PWM 컨트롤러의 B, 빨강선은 /B 포트에 연결
  - PWM 컨트롤러의 채널3, 채널2의 배타적인 ON(100%), OFF(0%) 신호로 열고 닫기
  - GasBreaker 객체의 open(), close() 메소드로 제어
  ```python
  gb = GasBreaker()
  gb.open() #시계방향  
  #현재 동작 완료는 약 6초
  gb.close() #반시계방향
  ```

### 디지털 입출력
- 디지털 입출력 장치 연결을 위해 범용 입출력(GPIO) 포트 제공
- 4개 디지털 입출력 포트 제공 (P8, P17, P18, P23)
  - XNode의 GPIO 포트에 연결되며, 운영 전압은 3V3 ~ 5V
  - 다양한 전원 포트 제공 (3V3, 5V, 12V, G(GND))

### 가스 감지기 제어
- 가스 감지기는 단순한 디지털 입력
- 검정선은 GND, 빨강선은 12V, 흰선(입력 신호)은 P18 포트에 연결
  - 가스가 감지되면 경보가 울리며 흰선(P18)이 높은 상태(HIGH)가 됨
  - GasDetect 객체의 read() 메소드로 상태 읽기
  ```python
  gd = GasDetect()
  ret = gd.read() #ret가 1이면 가수 누출, 0이면 정상
  ```

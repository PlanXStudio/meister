# 카메라 GUI
Serbot2에 연결된 CSI 카메라를 OpenCV로 읽어 QT GUI에 출력

## GSteamer 기반 OpenCV
```python
import cv2

cam_cmd = lambda cam_with=1280, cam_height=720, win_with=1280, win_height=720, rate=60, flip=2 : ('nvarguscamerasrc ! '
    'video/x-raw(memory:NVMM), '
    'width={0}, height={1}, '
    'format=NV12, framerate={2}/1 ! '
    'nvvidconv flip-method={3} ! '
    'video/x-raw, width={4}, height={5}, '
    'format=BGRx ! '
    'videoconvert ! appsink').format(cam_with, cam_height, rate, flip, win_with, win_height)

self.cam = cv2.VideoCapture(cam_cmd(), cv2.CAP_GSTREAMER)
```

## GUI 구현
### 스레드 버전 
```python
import cv2
import sys
from threading import Thread

from PySide6.QtWidgets import QApplication, QMainWindow
from PySide6.QtWidgets import QLabel, QPushButton
from PySide6.QtCore import QCoreApplication
from PySide6.QtGui import QImage, QPixmap, QFont

class CamUi(QMainWindow):
    def __init__(self):
        super().__init__()
        
        cam_cmd = lambda cam_with=1280, cam_height=720, win_with=1280, win_height=720, rate=60, flip=2 : ('nvarguscamerasrc ! '
            'video/x-raw(memory:NVMM), '
            'width={0}, height={1}, '
            'format=NV12, framerate={2}/1 ! '
            'nvvidconv flip-method={3} ! '
            'video/x-raw, width={4}, height={5}, '
            'format=BGRx ! '
            'videoconvert ! appsink').format(cam_with, cam_height, rate, flip, win_with, win_height)

        self.cam = cv2.VideoCapture(cam_cmd(), cv2.CAP_GSTREAMER)

        self.frame = QLabel(self)
        self.frame.resize(1280, 720)

        self.pbExit = QPushButton('Exit', self)
        self.pbExit.resize(120, 60)
        self.pbExit.setFont(QFont('', 50))
        self.pbExit.clicked.connect(self.onExit)

        self._is_run = True
        self.frameThread = Thread(target=self.__onFrame)
        self.frameThread.daemon = True
        self.frameThread.start()

    def __del__(self):
        onExit()

    def onExit(self):
        self._is_run = False
        self.frameThread.join()
        self.cam.release()
        QCoreApplication.instance().quit()

    def onFrame(self):
        ret, frame = self.cam.read()
        frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB) 
        h,w,c = frame.shape
        pixmap = QPixmap.fromImage(QImage(frame.data, w, h, w * c, QImage.Format_RGB888))
        self.frame.setPixmap(pixmap)

    def __onFrame(self):
        while self._is_run:
            self.onFrame()

if __name__ == '__main__':
    app = QApplication(sys.argv)
    win = CamUi()
    win.showFullScreen()
    sys.exit(app.exec_())
```

### QTimer 버전
```python

import cv2
import sys
from PySide6.QtWidgets import QApplication, QMainWindow
from PySide6.QtWidgets import QLabel, QPushButton
from PySide6.QtCore import QCoreApplication
from PySide6.QtGui import QImage, QPixmap, QFont
from PySide6.QtCore import QTimer

class CamUi(QMainWindow):
    def __init__(self):
        super().__init__()
        
        cam_cmd = lambda cam_with=1280, cam_height=720, win_with=1280, win_height=720, rate=60, flip=2 : ('nvarguscamerasrc ! '
            'video/x-raw(memory:NVMM), '
            'width={0}, height={1}, '
            'format=NV12, framerate={2}/1 ! '
            'nvvidconv flip-method={3} ! '
            'video/x-raw, width={4}, height={5}, '
            'format=BGRx ! '
            'videoconvert ! appsink').format(cam_with, cam_height, rate, flip, win_with, win_height)

        self.cam = cv2.VideoCapture(cam_cmd(), cv2.CAP_GSTREAMER)

        self.frame = QLabel(self)
        self.frame.resize(1280, 720)

        self.pbExit = QPushButton('Exit', self)
        self.pbExit.resize(120, 60)
        self.pbExit.setFont(QFont('', 50))
        self.pbExit.clicked.connect(self.onExit)

        self.capTimer = QTimer()
        self.capTimer.setInterval(10)
        self.capTimer.timeout.connect(self.onFrame)
        self.capTimer.start()

    def __del__(self):
        if self.capTimer.isActive():
            self.capTimer.stop()

    def onExit(self):
        self.capTimer.stop()
        self.cam.release()
        QCoreApplication.instance().quit()

    def onFrame(self):
        ret, frame = self.cam.read()
        frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB) 
        h,w,c = frame.shape
        pixmap = QPixmap.fromImage(QImage(frame.data, w, h, w * c, QImage.Format_RGB888))
        self.frame.setPixmap(pixmap)

if __name__ == '__main__':
    app = QApplication(sys.argv)
    win = CamUi()
    win.showFullScreen()
    sys.exit(app.exec_())
```
